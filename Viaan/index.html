<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mixture World</title>
    <style>
        /* Global styles for the page */
        body {
            font-family: Inter, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #e5e7eb; /* Softer, light gray background */
            color: #1f2937; /* Darker text for better contrast */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 1rem;
            box-sizing: border-box;
        }

        /* Main container for the game */
        #game-container {
            display: flex;
            flex-direction: column; 
            gap: 1.5rem;
            background-color: #ffffff;
            border-radius: 12px; /* Slightly less rounded */
            /* More subtle, realistic shadow */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            padding: 1.5rem;
            width: 100%;
            max-width: 800px; 
            border: 1px solid #d1d5db; /* Thin border */
        }

        @media (min-width: 768px) {
            #game-container {
                flex-direction: row; 
            }
        }

        /* --- Left Column: Ingredients --- */
        #ingredients-panel {
            flex: 1;
        }
        
        #ingredients-panel h2 {
            margin-top: 0;
            color: #1f2937;
            border-bottom: 2px solid #e5e7eb;
            padding-bottom: 0.5rem;
            /* More "professional" header style */
            text-transform: uppercase;
            font-size: 0.9rem;
            font-weight: 600;
            letter-spacing: 0.05em;
        }

        #ingredient-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem; 
        }

        #ingredient-buttons button {
            padding: 0.8rem 1rem;
            font-size: 1rem;
            font-weight: 500;
            /* More subdued, "equipment" gray */
            background-color: #4b5563; 
            color: white;
            border: none;
            border-radius: 6px; /* Squarer corners */
            cursor: pointer;
            transition: all 0.2s ease;
        }

        #ingredient-buttons button:hover {
            background-color: #374151; /* Darker gray on hover */
        }
        
        #ingredient-buttons button:disabled {
            background-color: #d1d5db; 
            color: #9ca3af;
            cursor: not-allowed;
        }

        /* --- Right Column: Lab Bench --- */
        #lab-bench {
            flex: 1.5; 
            display: flex;
            flex-direction: column;
        }
        
        #lab-bench h2 {
            margin-top: 0;
            color: #1f2937;
            border-bottom: 2px solid #e5e7eb;
            padding-bottom: 0.5rem;
            text-transform: uppercase;
            font-size: 0.9rem;
            font-weight: 600;
            letter-spacing: 0.05em;
        }
        
        /* --- REALISTIC VISUAL BEAKER --- */
        #beaker-visual-container {
            width: 100%;
            height: 220px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        /* Wrapper to hold beaker and effects */
        #beaker-wrapper {
            position: relative;
            width: 160px;
            height: 200px;
        }

        #beaker {
            /* Beaker is now positioned inside the wrapper */
            position: absolute;
            inset: 0;
            border: 4px solid #4b5563; /* Darker "glass" edge */
            border-top: none; 
            border-radius: 0 0 20px 20px; 
            background-color: #f9fafb; /* Slightly off-white glass */
            overflow: hidden; /* This MUST be here to clip the REAL liquid */
            /* Inner shadow to give "glass" depth */
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.1);
            z-index: 1; /* Sits behind effects */
        }

        /* Beaker lip */
        #beaker::before {
            content: '';
            position: absolute;
            top: -10px;
            left: -10px;
            right: -10px;
            height: 18px;
            border: 4px solid #4b5563;
            border-bottom: none;
            border-radius: 12px 12px 0 0;
        }
        
        /* Glass highlight "glint" */
        #beaker::after {
            content: '';
            position: absolute;
            top: 10px;
            right: 15px;
            width: 10px;
            height: 150px;
            background-color: #ffffff;
            opacity: 0.2;
            border-radius: 5px;
            transform: rotate(10deg);
        }

        #liquid {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 0; /* Starts empty */
            /* Default "water" liquid with gradient for depth */
            background: linear-gradient(to top, #3b82f6, #93c5fd); 
            border-radius: 0 0 16px 16px;
            transition: all 0.5s ease;
        }
        
        #effect-container {
            /* Sits directly on top of the beaker, in the wrapper */
            position: absolute;
            inset: 0; 
            pointer-events: none; 
            z-index: 2; /* Sits on top of the beaker */
            /* NO overflow: hidden here, so effects can escape */
        }
        
        /* --- Animation Keyframes --- */
        
        @keyframes pour-fall {
            0% { transform: translateY(-20px); opacity: 1; }
            100% { transform: translateY(150px); opacity: 0; }
        }
        
        @keyframes foam-over {
            0% { transform: translateX(-50%) scale(0.5); opacity: 0.8; bottom: 20px; }
            30% { transform: translateX(-50%) scale(1); opacity: 1; bottom: 180px; }
            100% { transform: translateX(-50%) scale(1.3); opacity: 0; bottom: 220px; }
        }
        
        @keyframes drip-fall {
            0% { height: 0; }
            30% { height: 0; opacity: 1; }
            90% { height: 210px; opacity: 1; }
            100% { height: 210px; opacity: 0; }
        }

        @keyframes puddle-spread {
            0% { width: 0; opacity: 0; }
            50% { width: 0; opacity: 1; }
            100% { width: 200px; opacity: 1; }
        }

        @keyframes fizz {
            0% { transform: translateY(0); opacity: 1; width: 4px; height: 4px; }
            100% { transform: translateY(-210px); opacity: 0; width: 12px; height: 12px; }
        }
        
        @keyframes fizz-2 {
            0% { transform: translateY(0); opacity: 0.8; width: 6px; height: 6px; }
            100% { transform: translateY(-190px); opacity: 0; width: 8px; height: 8px; }
        }
        
        /* NEW: Realistic Sinking Animation (Fast) */
        @keyframes sink-fast {
            0% { transform: translateY(-180px) translateX(0); opacity: 1; }
            100% { transform: translateY(0) translateX(0); opacity: 1; }
        }

        /* NEW: Realistic Floating Animation (Oil) */
        @keyframes rise-oil {
            0% { bottom: 0; transform: scale(0.5); opacity: 0.5; }
            100% { bottom: 160px; transform: scale(1); opacity: 0.9; } /* Floats to top */
        }

        /* NEW: Suspension Animation (Cloud/Flour) */
        @keyframes suspend-float {
            0% { transform: translate(0, 0); }
            25% { transform: translate(5px, -5px); }
            50% { transform: translate(0, -10px); }
            75% { transform: translate(-5px, -5px); }
            100% { transform: translate(0, 0); }
        }

        /* Dissolving particles */
        @keyframes dissolve {
            0% { transform: translateY(0) scale(1) rotate(0deg); opacity: 1; }
            100% { transform: translateY(-20px) scale(0.3) rotate(90deg); opacity: 0; }
        }
        
        /* --- Classes for effect particles --- */

        .particle-pour {
            position: absolute; top: 0; left: 50%; transform: translateX(-50%);
            animation: pour-fall 0.7s ease-in forwards;
        }
        .particle-pour.solid { width: 6px; height: 6px; border-radius: 50%; }
        .particle-pour.liquid { width: 4px; height: 40px; border-radius: 2px; }

        .foam {
            position: absolute; left: 50%; width: 150px; height: 150px;
            background: linear-gradient(to top, #f59e0b, #fde047);
            border-radius: 50%; opacity: 0; animation: foam-over 1.5s ease-out forwards;
        }

        .drip {
            position: absolute; top: 0; left: 10px; width: 20px;
            background: linear-gradient(to top, #f59e0b, #fde047);
            border-radius: 0 0 10px 10px; height: 0;
            animation: drip-fall 2s ease-in forwards; animation-delay: 0.5s;
        }
        .drip.right { left: auto; right: 10px; animation-delay: 0.7s; }
        
        .puddle {
            position: absolute; bottom: -10px; left: 50%; transform: translateX(-50%);
            width: 0; height: 15px; background: linear-gradient(to top, #f59e0b, #fde047);
            border-radius: 40px; opacity: 0;
            animation: puddle-spread 1.5s ease-out forwards; animation-delay: 1.5s;
        }

        .bubble {
            position: absolute; bottom: 10px; background: #ffffff;
            border: 1px solid #cceeff; border-radius: 50%;
            animation: fizz 1.5s ease-in infinite;
        }
        .bubble.var-2 { animation-name: fizz-2; animation-duration: 2.5s; }
        
        /* NEW: Specialized Particles */
        .particle-solid-sink {
            position: absolute; bottom: 10px; width: 6px; height: 6px; border-radius: 50%;
            animation: sink-fast 2s ease-in forwards;
        }

        .particle-oil-bubble {
            position: absolute; 
            width: 15px; height: 15px;
            background: rgba(253, 224, 71, 0.8); /* Yellow Oil */
            border: 1px solid rgba(234, 179, 8, 0.8);
            border-radius: 50%;
            animation: rise-oil 3s ease-out forwards;
        }

        .particle-suspension {
            position: absolute;
            background: rgba(255, 255, 255, 0.4);
            border-radius: 50%;
            filter: blur(1px);
            animation: suspend-float 4s infinite linear;
        }
        
        .particle-dissolve {
            position: absolute; bottom: 50px; width: 7px; height: 7px;
            background: #ffffff; border-radius: 2px;
            animation: dissolve 1.5s ease-in-out forwards;
        }
        
        /* --- End Visual Beaker CSS --- */


        /* The 'beaker' text display area */
        #beaker-display {
            min-height: 80px;
            background-color: #f9fafb; /* Off-white */
            border: 1px solid #e5e7eb; /* Light gray border */
            border-radius: 6px; /* Squarer */
            padding: 1rem;
            margin-bottom: 1rem;
        }
        
        #beaker-display-title {
            font-weight: 600; 
            color: #4b5563;
            margin: 0;
            font-size: 0.9rem;
            text-transform: uppercase;
        }
        
        #beaker-contents {
            margin: 0.5rem 0 0 0;
            padding-left: 1.5rem;
            color: #1d4ed8; /* Darker blue */
            font-weight: 500;
        }
        
        #beaker-contents li {
            margin-bottom: 0.25rem;
        }

        #action-buttons {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        #action-buttons button {
            flex: 1; 
            font-size: 1.1rem;
            font-weight: 600;
            padding: 0.8rem;
            border: none;
            border-radius: 6px; /* Squarer */
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        #action-buttons button:hover {
            transform: scale(1.02); /* Less "bouncy" */
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        #mix-btn {
            background-color: #059669; /* Darker "science" green */
            color: white;
        }

        #reset-btn {
            background-color: #dc2626; /* Darker "warning" red */
            color: white;
        }

        /* Music Button Style */
        #music-btn {
            background-color: #8b5cf6; /* Violet */
            color: white;
        }

        /* Result box with more professional styling */
        #result-box {
            background-color: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            padding: 1.25rem;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        #result-type {
            font-weight: 700; 
            font-size: 1.2rem;
            margin: 0 0 0.5rem 0;
        }
        
        #result-text {
            margin: 0;
            font-size: 1rem;
            line-height: 1.5;
        }

        .type-reaction { color: #f59e0b; } 
        .type-mixture-homo { color: #8b5cf6; } 
        .type-mixture-hetero { color: #06b6d4; } 
        .type-none { color: #6b7280; } /* Neutral gray */

    </style>
</head>
<body>

    <div id="game-container">
        
        <div id="ingredients-panel">
            <h2>Ingredients</h2>
            <div id="ingredient-buttons">
                <!-- Buttons will be added here by JavaScript -->
            </div>
        </div>

        <div id="lab-bench">
            <h2>Lab Bench</h2>

            <!-- VISUAL BEAKER -->
            <div id="beaker-visual-container">
                <!-- Wrapper holds beaker and effects -->
                <div id="beaker-wrapper"> 
                    <div id="beaker">
                        <div id="liquid"></div>
                    </div>
                    <!-- Effect container is ON TOP of beaker -->
                    <div id="effect-container"></div> 
                </div>
            </div>

            <!-- Beaker Contents (Text List) -->
            <div id="beaker-display">
                <p id="beaker-display-title">Beaker Contents</p>
                <ul id="beaker-contents">
                    <!-- Added ingredients will appear here -->
                </ul>
            </div>

            <div id="action-buttons">
                <button id="mix-btn">üß™ Mix!</button>
                <button id="reset-btn">üóëÔ∏è Reset</button>
                <!-- Music Button -->
                <button id="music-btn">üéµ Music: Off</button>
            </div>

            <div id="result-box">
                <p id="result-type" class="type-none">Waiting for experiment...</p>
                <p id="result-text">Add 2 or more ingredients and press "Mix".</p>
            </div>
        </div>
    </div>

    <script>
        // --- 1. DEFINE INGREDIENTS ---
        const ingredients = {
            water: { name: "Water (H‚ÇÇO)", type: "liquid", color: "#3b82f6" },
            salt: { name: "Salt (NaCl)", type: "solid", color: "#ffffff" },
            sand: { name: "Sand (SiO‚ÇÇ)", type: "solid", color: "#78350f" },
            bakingSoda: { name: "Baking Soda (NaHCO‚ÇÉ)", type: "solid", color: "#f1f5f9" },
            vinegar: { name: "Vinegar (CH‚ÇÉCOOH)", type: "liquid", color: "#e0e7ff" },
            ironFilings: { name: "Iron Filings (Fe)", type: "solid", color: "#4b5563" },
            sugar: { name: "Sugar (C‚ÇÅ‚ÇÇH‚ÇÇ‚ÇÇO‚ÇÅ‚ÇÅ)", type: "solid", color: "#ffffff" },
            oil: { name: "Vegetable Oil", type: "liquid", color: "#fde047" },
            foodColoring: { name: "Food Coloring", type: "liquid", color: "#ef4444" },
            flour: { name: "Flour", type: "solid", color: "#f8fafc" }
        };

        // --- 2. DEFINE OUTCOMES ---
        const outcomes = {
            "salt,water": { type: "Homogeneous Mixture", typeClass: "type-mixture-homo", text: "In real life, the salt crystals disappear into the water. If you tasted it, it would be salty! This is a physical change." },
            "sand,water": { type: "Heterogeneous Mixture", typeClass: "type-mixture-hetero", text: "In real life, the sand would get wet and heavy, sinking right to the bottom of the glass. The water above stays mostly clear." },
            "bakingSoda,vinegar": { type: "Chemical Reaction!", typeClass: "type-reaction", text: "In real life, this erupts! It bubbles up violently like a volcano, making a sizzling sound and spilling over. A gas (CO‚ÇÇ) is escaping." },
            "ironFilings,sand": { type: "Heterogeneous Mixture", typeClass: "type-mixture-hetero", text: "In real life, you just see a gritty pile of brown sand mixed with gray metal specks. They don't stick together at all." },
            "sugar,water": { type: "Homogeneous Mixture", typeClass: "type-mixture-homo", text: "In real life, the sugar granules vanish as you stir. The water looks the same, but it becomes thick and sticky." },
            "oil,water": { type: "Heterogeneous Mixture", typeClass: "type-mixture-hetero", text: "In real life, the oil refuses to mix! It forms a shiny yellow layer bubbling and floating on top of the water." },
            "foodColoring,water": { type: "Homogeneous Mixture", typeClass: "type-mixture-homo", text: "In real life, the dye swirls around like smoke before turning all the water a bright red color. It never settles to the bottom." },
            "flour,water": { type: "Heterogeneous Mixture", typeClass: "type-mixture-hetero", text: "In real life, the water turns white and murky. It feels gooey, like glue or pancake batter. Eventually, the flour settles to the bottom." },
            "ironFilings,water": { type: "Heterogeneous Mixture", typeClass: "type-mixture-hetero", text: "In real life, the heavy metal bits drop instantly to the bottom, clinking against the glass. They do not dissolve." },
            "bakingSoda,oil": { type: "Heterogeneous Mixture", typeClass: "type-mixture-hetero", text: "In real life, the powder just sits at the bottom in a clump. The oil doesn't fizz or react with it at all." }
        };

        // --- 3. GET HTML ELEMENTS ---
        const ingredientButtonsEl = document.getElementById("ingredient-buttons");
        const beakerContentsEl = document.getElementById("beaker-contents");
        const mixButtonEl = document.getElementById("mix-btn");
        const resetButtonEl = document.getElementById("reset-btn");
        const musicBtnEl = document.getElementById("music-btn");
        const resultTypeEl = document.getElementById("result-type");
        const resultTextEl = document.getElementById("result-text");
        const liquidEl = document.getElementById("liquid");
        const effectContainerEl = document.getElementById("effect-container");
        
        let waterGradient = 'linear-gradient(to top, #3b82f6, #93c5fd)';
        const redGradient = 'linear-gradient(to top, #dc2626, #fca5a5)';
        const cloudyGradient = 'linear-gradient(to top, #d1d5db, #f9fafb)';
        const oilWaterGradient = 'linear-gradient(to top, #3b82f6 0%, #3b82f6 50%, #fde047 50%, #fde047 100%)';

        // --- 4. GAME STATE ---
        let itemsInBeaker = []; 
        let isMusicPlaying = false;

        // --- 5. SYNTHESIZER ENGINE (Web Audio API) ---
        let audioCtx;
        let nextNoteTime = 0.0;
        let timerID;
        let noteIndex = 0;
        const melody = [261.63, 261.63, 392.00, 523.25, 261.63, 329.63, 392.00, 523.25, 349.23, 349.23, 440.00, 523.25, 392.00, 392.00, 493.88, 523.25];
        const tempo = 180;
        const secondsPerBeat = 60.0 / tempo;
        const lookahead = 25.0;
        const scheduleAheadTime = 0.1;

        function initAudio() {
            if (!audioCtx) {
                const AudioContext = window.AudioContext || window.webkitAudioContext;
                audioCtx = new AudioContext();
            }
        }

        function nextNote() {
            const secondsPerNote = secondsPerBeat / 2; 
            nextNoteTime += secondsPerNote; 
            noteIndex++;
            if (noteIndex === melody.length) noteIndex = 0;
        }

        function scheduleNote(beatNumber, time) {
            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            osc.type = 'square';
            osc.frequency.value = melody[beatNumber];
            gainNode.gain.setValueAtTime(0.05, time); 
            gainNode.gain.exponentialRampToValueAtTime(0.001, time + 0.1);
            osc.start(time);
            osc.stop(time + 0.1);
        }

        function scheduler() {
            while (nextNoteTime < audioCtx.currentTime + scheduleAheadTime) {
                scheduleNote(noteIndex, nextNoteTime);
                nextNote();
            }
            timerID = window.setTimeout(scheduler, lookahead);
        }

        function toggleMusic() {
            initAudio();
            if (audioCtx.state === 'suspended') audioCtx.resume();

            if (!isMusicPlaying) {
                isMusicPlaying = true;
                noteIndex = 0;
                nextNoteTime = audioCtx.currentTime;
                scheduler(); 
                musicBtnEl.textContent = "üéµ Music: On";
            } else {
                isMusicPlaying = false;
                window.clearTimeout(timerID); 
                musicBtnEl.textContent = "üéµ Music: Off";
            }
        }

        // --- 6. GAME FUNCTIONS ---

        function addIngredient(id) {
            itemsInBeaker.push(id);
            document.querySelector(`button[data-id="${id}"]`).disabled = true;
            updateBeakerDisplay();
            clearResult();
            createPourAnimation(id);
            
            if (id === 'foodColoring') {
                waterGradient = redGradient; 
                liquidEl.style.background = waterGradient;
            } else if (id === 'flour') {
                liquidEl.style.background = cloudyGradient;
            } else if (itemsInBeaker.length === 1 && id !== 'oil') {
                liquidEl.style.background = waterGradient;
            }
            const newHeight = 30 + (itemsInBeaker.length * 25);
            liquidEl.style.height = `${newHeight}px`;
        }

        function updateBeakerDisplay() {
            beakerContentsEl.innerHTML = ""; 
            if (itemsInBeaker.length === 0) {
                const li = document.createElement("li");
                li.textContent = "Empty";
                li.style.color = "#9ca3af"; 
                beakerContentsEl.appendChild(li);
            } else {
                itemsInBeaker.forEach(id => {
                    const li = document.createElement("li");
                    li.textContent = ingredients[id].name; 
                    beakerContentsEl.appendChild(li);
                });
            }
        }
        
        function mixItems() {
            clearEffects();
            
            if (itemsInBeaker.length < 2) {
                resultTypeEl.textContent = "Error";
                resultTypeEl.className = "type-none";
                resultTextEl.textContent = "You need at least 2 ingredients to mix!";
                return;
            }

            const key = [...itemsInBeaker].sort().join(',');
            const result = outcomes[key];
            
            if (key === 'oil,water') {
                liquidEl.style.background = oilWaterGradient;
            }

            if (result) {
                resultTypeEl.textContent = result.type;
                resultTypeEl.className = result.typeClass;
                resultTextEl.textContent = result.text;
                
                if (result.typeClass === 'type-reaction') {
                    liquidEl.style.height = '200px'; 
                    liquidEl.style.background = 'linear-gradient(to top, #f59e0b, #fde047)'; 
                    createFizz(20); 
                    createOverflow(); 
                } else if (result.typeClass === 'type-mixture-homo') {
                    createDissolve(15); 
                } else {
                    // --- NEW: REALISTIC MIXTURE LOGIC ---
                    // Instead of generic settling, check what's actually in there!
                    visualizeMixture(itemsInBeaker);
                }
                
            } else {
                resultTypeEl.textContent = "Heterogeneous Mixture";
                resultTypeEl.className = "type-mixture-hetero";
                resultTextEl.textContent = "In real life, this would just be a messy goop. You'd see bits floating and bits sinking, but no cool reaction happens.";
                visualizeMixture(itemsInBeaker);
                liquidEl.style.background = 'linear-gradient(to top, #9ca3af, #e5e7eb)'; 
            }
        }

        function clearResult() {
            resultTypeEl.textContent = "Waiting for experiment...";
            resultTypeEl.className = "type-none";
            resultTextEl.textContent = "Press 'Mix' to see the result.";
            clearEffects();
            if (itemsInBeaker.length > 0) {
                if (itemsInBeaker.includes('flour')) {
                    liquidEl.style.background = cloudyGradient;
                } else {
                    liquidEl.style.background = waterGradient;
                }
            }
        }

        function resetBeaker() {
            itemsInBeaker = []; 
            updateBeakerDisplay();
            clearResult(); 
            document.querySelectorAll("#ingredient-buttons button").forEach(btn => {
                btn.disabled = false;
            });
            waterGradient = 'linear-gradient(to top, #3b82f6, #93c5fd)'; 
            liquidEl.style.height = '0px';
            liquidEl.style.background = waterGradient;
            clearEffects();
        }
        
        // --- 6. ANIMATION HELPER FUNCTIONS ---
        
        function clearEffects() {
            effectContainerEl.innerHTML = '';
        }

        // NEW: Advanced visualization for mixtures
        function visualizeMixture(items) {
            items.forEach(id => {
                // If it's oil, make it rise!
                if (id === 'oil') {
                    createOilBubbles(20);
                } 
                // If it's flour, make it float (suspension)
                else if (id === 'flour') {
                    createSuspension(30);
                }
                // If it's heavy stuff (sand/iron/solids), make it sink
                else if (ingredients[id].type === 'solid' && id !== 'flour') {
                    createSolidSink(25, ingredients[id].color);
                }
            });
        }

        function createPourAnimation(id) {
            const ingredient = ingredients[id];
            for (let i = 0; i < 5; i++) { 
                const particle = document.createElement('div');
                particle.className = 'particle-pour';
                if (ingredient.type === 'solid') {
                    particle.classList.add('solid');
                    particle.style.background = ingredient.color;
                } else {
                    particle.classList.add('liquid');
                    particle.style.background = ingredient.color;
                }
                particle.style.left = `${Math.random() * 60 + 20}%`; 
                particle.style.animationDelay = `${Math.random() * 0.2}s`;
                effectContainerEl.appendChild(particle);
            }
        }

        function createOverflow() {
            const foam = document.createElement('div');
            foam.className = 'foam';
            effectContainerEl.appendChild(foam);
            const drip1 = document.createElement('div');
            drip1.className = 'drip';
            effectContainerEl.appendChild(drip1);
            const drip2 = document.createElement('div');
            drip2.className = 'drip right';
            effectContainerEl.appendChild(drip2);
            const puddle = document.createElement('div');
            puddle.className = 'puddle';
            effectContainerEl.appendChild(puddle);
        }

        function createFizz(n) {
            for (let i = 0; i < n; i++) {
                const bubble = document.createElement('div');
                bubble.className = (Math.random() > 0.5) ? 'bubble' : 'bubble var-2';
                bubble.style.left = `${Math.random() * 80 + 10}%`; 
                bubble.style.animationDelay = `${Math.random() * 2}s`;
                effectContainerEl.appendChild(bubble);
            }
        }
        
        // NEW: Specific Sinking Animation for Solids
        function createSolidSink(n, color) {
            for (let i = 0; i < n; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle-solid-sink';
                particle.style.background = color;
                particle.style.left = `${Math.random() * 90 + 5}%`;
                // Add a random offset to bottom to make them "pile up"
                particle.style.bottom = `${Math.random() * 20}px`; 
                particle.style.animationDelay = `${Math.random() * 0.5}s`;
                effectContainerEl.appendChild(particle);
            }
        }

        // NEW: Oil Bubble Animation
        function createOilBubbles(n) {
            for (let i = 0; i < n; i++) {
                const bubble = document.createElement('div');
                bubble.className = 'particle-oil-bubble';
                bubble.style.left = `${Math.random() * 90 + 5}%`;
                bubble.style.animationDelay = `${Math.random() * 1}s`;
                effectContainerEl.appendChild(bubble);
            }
        }

        // NEW: Suspension Animation
        function createSuspension(n) {
            for (let i = 0; i < n; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle-suspension';
                particle.style.width = `${Math.random() * 4 + 2}px`;
                particle.style.height = particle.style.width;
                particle.style.left = `${Math.random() * 80 + 10}%`;
                particle.style.bottom = `${Math.random() * 150 + 20}px`; // Float anywhere
                particle.style.animationDelay = `${Math.random() * 2}s`;
                effectContainerEl.appendChild(particle);
            }
        }
        
        function createDissolve(n) {
            for (let i = 0; i < n; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle-dissolve';
                particle.style.left = `${Math.random() * 80 + 10}%`;
                particle.style.bottom = `${Math.random() * 40 + 30}px`; 
                particle.style.animationDelay = `${Math.random() * 1}s`;
                effectContainerEl.appendChild(particle);
            }
        }

        function createSettle(n) {
             // Kept for fallback, but specialized functions are preferred
             createSolidSink(n, '#78350f');
        }

        function createIngredientButtons() {
            for (const id in ingredients) {
                const name = ingredients[id].name; 
                const button = document.createElement("button");
                button.textContent = name;
                button.dataset.id = id; 
                button.addEventListener("click", () => addIngredient(id));
                ingredientButtonsEl.appendChild(button);
            }
        }
        
        createIngredientButtons();
        mixButtonEl.addEventListener("click", mixItems);
        resetButtonEl.addEventListener("click", resetBeaker);
        musicBtnEl.addEventListener("click", toggleMusic);
        updateBeakerDisplay(); 

    </script>
</body>
</html>

